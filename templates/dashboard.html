{% extends 'base.html' %} {% block content %}

<div class="content-page" style="position: relative; z-index: 1; margin-top: 14px;">
    <div class="container-fluid">
        <div class="card-header-toolbar d-flex align-items-center"></div>
        <div class="row">
            <div class="col-lg-12">
                {% if messages %}
                <div id="errbox" class="errbox">
                    {% for message in messages %}
                    <div class="errbox-icon">&#9888;</div>
                    <div class="errbox-content">
                        <h4 style="color: var(--main-color);">{{ message.tags.title }}</h4>
                        <p>{{ message }}</p>
                    </div>
                    <button class="errbox-close" onclick="document.getElementById('errbox').style.display='none'">&times;</button>
                    {% endfor %}
                </div>
                {% endif %}
                <h5 style="margin-bottom: 25px; margin-top: -18px; font-weight: 600; color: var(--text-color);">General Statistics</h5>
                <div class="row" style="position: relative; top: -20px;">
                    <div style="height: 130px;" class="col-lg-3 col-md-3 g-4">
                        <div class="card card-block card-stretch card-height" style="background-color: var(--main-color);">
                            <div class="card-body">
                                <a href="{% url 'student-list' %}">
                                    <div class="d-flex align-items-center mb-4 card-total-sale">
                                        <div class="icon iq-icon-box-2 bg-info-light" style="background-color: white !important;">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 1024 768">
                                                <path
                                                    fill="var(--main-color)"
                                                    d="M1024 736q0 13-9.5 22.5T992 768t-22.5-9.5T960 736V315L607 492q-40 20-95 20t-95-20L39 303Q0 283 0 255.5T39 209L417 20q40-20 95-20t95 20l378 189q34 17 38 42q1 1 1 4v481zM639 556l193-97v141q0 43-93.5 73.5T512 704t-226.5-30.5T192 600V459l193 97q40 20 127 20t127-20z"
                                                ></path>
                                            </svg>
                                        </div>
                                        <div>
                                            <p class="mb-2" style="color: white;">Students</p>
                                            <h4 style="color: white;" class="count" data-type="number" data-target="{{ students.count }}">0</h4>
                                        </div>
                                    </div>
                                </a>
                            </div>
                        </div>
                    </div>
                    <div style="height: 130px;" class="col-lg-3 col-md-3 g-4">
                        <div class="card card-block card-stretch card-height" style="background-color: var(--main-color);">
                            <div class="card-body">
                                <a href="{% url 'teachers-list' %}">
                                    <div title="Total Teachers" class="d-flex align-items-center mb-4 card-total-sale">
                                        <div class="icon iq-icon-box-2 bg-success-light" style="background-color: white !important;">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" stroke="var(--main-color)" stroke-width="0.5" viewBox="0 0 20 20">
                                                <path
                                                    fill="var(--main-color)"
                                                    d="M8.75 3.75a2.75 2.75 0 1 0-5.5 0a2.75 2.75 0 0 0 5.5 0Zm-4.5 0a1.75 1.75 0 1 1 3.5 0a1.75 1.75 0 0 1-3.5 0ZM2.5 7.5h4.183c-.164.31-.286.646-.358 1H2.5A.5.5 0 0 0 2 9v.5c0 1.26 1.099 2.614 3.096 2.93c-.322.22-.59.513-.781.854C2.205 12.713 1 11.087 1 9.5V9a1.5 1.5 0 0 1 1.5-1.5Zm5.379 0c.504-.61 1.267-1 2.121-1a2.744 2.744 0 0 1 2.646 2a2.753 2.753 0 0 1-3.893 3.202A2.75 2.75 0 0 1 7.88 7.5Zm.54 1a1.75 1.75 0 1 0 3.164 1.5a1.75 1.75 0 0 0-3.165-1.5Zm7.266 4.784a2.513 2.513 0 0 0-.781-.853C16.9 12.114 18 10.759 18 9.5V9a.5.5 0 0 0-.5-.5h-3.825a3.726 3.726 0 0 0-.357-1H17.5A1.5 1.5 0 0 1 19 9v.5c0 1.587-1.206 3.212-3.315 3.784Zm-1.198.087A1.493 1.493 0 0 0 13.5 13h-7A1.496 1.496 0 0 0 5 14.5v.5c0 1.971 1.86 4 5 4c3.14 0 5-2.029 5-4v-.5c0-.45-.198-.854-.513-1.13ZM6 14.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 .5.5v.5c0 1.438-1.432 3-4 3s-4-1.562-4-3v-.5ZM14 1a2.75 2.75 0 1 1 0 5.5A2.75 2.75 0 0 1 14 1Zm0 1a1.75 1.75 0 1 0 0 3.5A1.75 1.75 0 0 0 14 2Z"
                                                ></path>
                                            </svg>
                                        </div>
                                        <div>
                                            <p class="mb-2" style="color: white;">Teachers</p>
                                            <h4 style="color: white;" class="count" data-type="number" data-target="{{ teachers.count }}">0</h4>
                                        </div>
                                    </div>
                                </a>
                            </div>
                        </div>
                    </div>
                    <div style="height: 130px;" class="col-lg-3 col-md-3 g-4">
                        <div class="card card-block card-stretch card-height" style="background-color: var(--main-color);">
                            <div class="card-body">
                                <a href="{% url 'course-list' %}">
                                    <div class="d-flex align-items-center mb-4 card-total-sale">
                                        <div class="icon iq-icon-box-2 bg-danger-light" style="background-color: white !important;">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 24 24">
                                                <path fill="var(--main-color)" d="M19 3h-2v6.5l-3-2.25l-3 2.25V3H5v18h14V3Zm-6 0v2.5l1-.75l1 .75V3h-2Zm8 20H3V1h18v22Z"></path>
                                            </svg>
                                        </div>
                                        <div>
                                            <p class="mb-2" style="color: white;">Courses</p>
                                            <h4 style="color: white;" class="count" data-type="number" data-target="{{ courses.count }}">0</h4>
                                        </div>
                                    </div>
                                </a>
                            </div>
                        </div>
                    </div>
                    <div style="height: 130px;" class="col-lg-3 col-md-3 g-4">
                        <div class="card card-block card-stretch card-height" style="background-color: var(--main-color);">
                            <div class="card-body">
                                <a href="{% url 'select-course' %}">
                                    <div class="d-flex align-items-center mb-4 card-total-sale">
                                        <div class="icon iq-icon-box-2 bg-success-light" style="background-color: white !important;">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 24 24">
                                                <path
                                                    fill="var(--main-color)"
                                                    d="M17.5 12a5.5 5.5 0 1 1 0 11a5.5 5.5 0 0 1 0-11Zm-2.646 5.147a.5.5 0 1 0-.707.707l2 2a.5.5 0 0 0 .707 0l4-4a.5.5 0 1 0-.707-.707L16.5 18.793l-1.646-1.646ZM12.023 14a6.47 6.47 0 0 0-.709 1.5H4.253a.749.749 0 0 0-.75.75v.577c0 .535.192 1.053.54 1.46c1.253 1.469 3.22 2.214 5.957 2.214c.597 0 1.157-.035 1.68-.106c.246.495.553.954.912 1.367c-.795.16-1.66.24-2.592.24c-3.146 0-5.532-.906-7.098-2.74a3.75 3.75 0 0 1-.898-2.435v-.578A2.249 2.249 0 0 1 4.253 14h7.77ZM10 2.005a5 5 0 1 1 0 10a5 5 0 0 1 0-10Zm0 1.5a3.5 3.5 0 1 0 0 7a3.5 3.5 0 0 0 0-7Z"
                                                ></path>
                                            </svg>
                                        </div>
                                        <div>
                                            <p class="mb-2" style="color: white;">Rate</p>
                                            <h4 style="color: white;" class="count" data-type="percent" data-target="{{ attendance_rate|floatformat:2 }}">0%</h4>
                                        </div>
                                    </div>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                <h5 style="margin-bottom: 25px; margin-top: -38px; font-weight: 600; color: var(--text-color);">Today’s Statistics</h5>
                <div class="row" style="position: relative; top: -20px;">
                    <div style="height: 130px;" class="col-lg-3 col-md-3 ">
                        <div class="card card-block card-stretch card-height" style="background-color: white;">
                            <div class="card-body">
                                <div class="d-flex align-items-center mb-4 card-total-sale">
                                    <div class="icon iq-icon-box-2 bg-success-light" style="background-color: var(--main-color) !important;">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 10 10">
                                            <path
                                                fill="white"
                                                d="M4.998 0a4.998 4.998 0 1 0 0 9.995a4.998 4.998 0 0 0 0-9.995ZM1 4.998a3.998 3.998 0 1 1 7.995 0a3.998 3.998 0 0 1-7.995 0Zm6.104-1.602a.5.5 0 0 1 0 .708l-2.25 2.25a.5.5 0 0 1-.708 0l-1-1a.5.5 0 1 1 .708-.708l.646.647l1.896-1.897a.5.5 0 0 1 .708 0Z"
                                            ></path>
                                        </svg>
                                    </div>
                                    <div>
                                        <p class="mb-2" style="color: black;">Present</p>
                                        <h4 style="color: black;" class="count" data-type="number" data-target="{{ present_student.count }}">0</h4>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div style="height: 130px;" class="col-lg-3 col-md-3">
                        <div class="card card-block card-stretch card-height" style="background-color: white;">
                            <div class="card-body">
                                <div class="d-flex align-items-center mb-4 card-total-sale">
                                    <div class="icon iq-icon-box-2 bg-success-light" style="background-color: var(--main-color) !important;">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 16 16">
                                            <path
                                                fill="white"
                                                fill-rule="evenodd"
                                                d="M14.1 13.2c1.2-1.4 1.92-3.21 1.92-5.2c0-4.42-3.58-8-8-8s-8 3.58-8 8s3.58 8 8 8a7.98 7.98 0 0 0 6.084-2.804zm-1.59.174a6.96 6.96 0 0 1-4.49 1.63c-3.87 0-7-3.13-7-7c0-1.71.612-3.27 1.63-4.49zm.884-.884l-9.86-9.86A6.96 6.96 0 0 1 8.024 1c3.87 0 7 3.13 7 7c0 1.71-.612 3.27-1.63 4.49"
                                                clip-rule="evenodd"
                                            ></path>
                                        </svg>
                                    </div>
                                    <div>
                                        <p class="mb-2" style="color: black;">Absent</p>
                                        <h4 style="color: black;" class="count" data-type="number" data-target="{{ absent_students.count }}">0</h4>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div style="height: 130px;" class="col-lg-3 col-md-3">
                        <div class="card card-block card-stretch card-height" style="background-color: white;">
                            <div class="card-body">
                                <div class="d-flex align-items-center mb-4 card-total-sale">
                                    <div class="icon iq-icon-box-2 bg-success-light" style="background-color: var(--main-color) !important;">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 24 24">
                                            <path fill="white" d="M12 21.934A9.934 9.934 0 1 1 21.933 12A9.945 9.945 0 0 1 12 21.934Zm0-18.868A8.934 8.934 0 1 0 20.933 12A8.944 8.944 0 0 0 12 3.066Z" />
                                            <path
                                                fill="white"
                                                d="M9 10.258a1.5 1.5 0 1 1 1.061-.439A1.5 1.5 0 0 1 9 10.258Zm0-2a.5.5 0 1 0 .353.146A.5.5 0 0 0 9 8.259Zm-1.242 8.485a.5.5 0 0 1-.358-.853l8.489-8.49a.5.5 0 0 1 .707.707L8.111 16.6a.5.5 0 0 1-.353.143ZM15 16.742a1.5 1.5 0 1 1 1.061-.438a1.493 1.493 0 0 1-1.061.438Zm0-2a.5.5 0 0 0-.354.147a.5.5 0 0 0-.146.352a.5.5 0 1 0 1 0a.5.5 0 0 0-.5-.5Z"
                                            ></path>
                                        </svg>
                                    </div>
                                    <div>
                                        <p class="mb-2" style="color: black;">Rate</p>
                                        <h4 style="color: black;" class="count" data-type="percent" data-target="{{ attendance_rate_today|floatformat:2 }}">0%</h4>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div style="height: 130px;" class="col-lg-3 col-md-3">
                        <div class="card card-block card-stretch card-height" style="background-color: white;">
                            <div class="card-body">
                                <div class="d-flex align-items-center mb-4 card-total-sale">
                                    <div class="icon iq-icon-box-2 bg-success-light" style="background-color: var(--main-color) !important;">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 24 24">
                                            <path fill="white" d="M19 3h-2v6.5l-3-2.25l-3 2.25V3H5v18h14V3Zm-6 0v2.5l1-.75l1 .75V3h-2Zm8 20H3V1h18v22Z"></path>
                                        </svg>
                                    </div>
                                    <div>
                                        <p class="mb-2" style="color: black;">Courses</p>
                                        <h4 style="color: black;" class="count" data-type="number" data-target="{{ todays_courses }}"></h4>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-6 col-md-3" style="position: relative; top: -20px;">
                <div class="card card-block card-stretch" style="background-color: var(--background-color); height: 370px;">
                    <!-- 👈 set your desired height -->
                    <div class="card-header d-flex align-items-center justify-content-between">
                        <div class="header-title">
                            <h4 class="card-title">Attendance Records</h4>
                        </div>
                        <!-- your buttons here -->
                    </div>
                    <div class="card-body" style="height: calc(100% - 60px);">
                        <!-- 👈 subtract header height -->
                        <div style="height: 100%;">
                            <canvas id="lineChart" style="height: 100% !important; width: 100% !important;"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-3" style="position: relative; top: -20px;">
                <div class="card card-block card-stretch" style="background-color: var(--background-color); height: 370px;">
                    <div class="card-header d-flex align-items-center justify-content-between" style="">
                        <div class="header-title">
                            <h4 class="card-title">Gender Distribution</h4>
                        </div>
                    </div>
                    <div class="card-body" style="height: calc(100% - 60px);">
                        <div style="overflow: auto; height: 100%;">
                            <canvas id="pieChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-3 col-md-3" style="position: relative; top: -20px;">
                <div class="card card-block card-stretch" style="background-color: var(--background-color); height: 370px;">
                    <!-- 👈 set your desired height -->
                    <div class="card-header d-flex align-items-center justify-content-between">
                        <div class="header-title" style="display: flex; align-items: center; gap: 2px;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><g fill="var(--main-color)"><path d="m12.594 23.258l-.012.002l-.071.035l-.02.004l-.014-.004l-.071-.036q-.016-.004-.024.006l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.016-.018m.264-.113l-.014.002l-.184.093l-.01.01l-.003.011l.018.43l.005.012l.008.008l.201.092q.019.005.029-.008l.004-.014l-.034-.614q-.005-.019-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.003-.011l.018-.43l-.003-.012l-.01-.01z"/><path fill="var(--main-color)" d="M9.107 5.448c.598-1.75 3.016-1.803 3.725-.159l.06.16l.807 2.36a4 4 0 0 0 2.276 2.411l.217.081l2.36.806c1.75.598 1.803 3.016.16 3.725l-.16.06l-2.36.807a4 4 0 0 0-2.412 2.276l-.081.216l-.806 2.361c-.598 1.75-3.016 1.803-3.724.16l-.062-.16l-.806-2.36a4 4 0 0 0-2.276-2.412l-.216-.081l-2.36-.806c-1.751-.598-1.804-3.016-.16-3.724l.16-.062l2.36-.806A4 4 0 0 0 8.22 8.025l.081-.216zM19 2a1 1 0 0 1 .898.56l.048.117l.35 1.026l1.027.35a1 1 0 0 1 .118 1.845l-.118.048l-1.026.35l-.35 1.027a1 1 0 0 1-1.845.117l-.048-.117l-.35-1.026l-1.027-.35a1 1 0 0 1-.118-1.845l.118-.048l1.026-.35l.35-1.027A1 1 0 0 1 19 2"/></g></svg>
                            <h4 class="card-title" style="font-family: 'Nunito', sans-serif; font-size: 24px;">
                                <b>zed<span style="color: var(--main-color); font-size: 24px;">AI</span></b>
                            </h4>
                        </div>
                    </div>
                    <div class="card-body" style="height: calc(100% - 60px);">
                        <div style="height: 100%;">
                                    <p style="font-size: 16px;">
                                        <span style="color: var(--main-color); font-size: 18px;"><b>> </b></span> Predicted attendance for the next week: <span style="font-size: 20px; color: var(--main-color);"><b>{% if predicted_attendance_rate.predicted_attendance_rate > 100 %}100{% else %}{{ predicted_attendance_rate.predicted_attendance_rate }}{% endif %}%</b></span>
                                    </p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-6" style="position: relative; top: -20px;">
                <div class="card card-block card-stretch" style="background-color: var(--background-color);">
                    <div class="card-header d-flex align-items-center justify-content-between" style="">
                        <div class="header-title">
                            <h4 class="card-title">High Attendance</h4>
                        </div>
                    </div>
                    <div class="card-body">
                        <div style="overflow: auto; height: 370px;">
                            <table class="table">
                                <thead class=" ">
                                    <tr class="ligth ligth-data">
                                        <th style="text-align: start; color: var(--text-color);">Student</th>
                                        <th style="text-align: left; color: var(--text-color);">Course</th>
                                        <th style="text-align: left; color: var(--text-color);">Rate</th>
                                    </tr>
                                </thead>
                                <tbody class="ligth-body">
                                    {% for record in top_students %}
                                    <tr>
                                        <td style="text-align: start;">
                                            <a title="Details" style="color: var(--text-color);" href="{% url 'student-details' record.id %}">{{ record.first_name }} {{ record.last_name }}</a>
                                        </td>
                                        <td style="text-align: start;"><a title="Details" style="color: var(--text-color);" href="{% url 'course-details' record.course.id %}">{{ record.course }}</a></td>
                                        <td style="color: var(--text-color);text-align: start;">{{ record.attendance_rate|floatformat:2 }}%</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-6" style="position: relative; top: -20px;">
                <div class="card card-block card-stretch" style="background-color: var(--background-color);">
                    <div class="card-header d-flex align-items-center justify-content-between" style="">
                        <div class="header-title">
                            <h4 class="card-title">Low Attendance</h4>
                        </div>
                    </div>
                    <div class="card-body">
                        <div style="overflow: auto; height: 370px;">
                            <table class="table">
                                <thead class=" ">
                                    <tr class="ligth ligth-data">
                                        <th style="text-align: start; color: var(--text-color);">Student</th>
                                        <th style="text-align: left; color: var(--text-color);">Course</th>
                                        <th style="text-align: left; color: var(--text-color);">Rate</th>
                                    </tr>
                                </thead>
                                <tbody class="ligth-body">
                                    {% for record in students_low_attendance %}
                                    <tr>
                                        <td style="text-align: start;">
                                            <a title="Details" style="color: var(--text-color);" href="{% url 'student-details' record.id %}">{{ record.first_name }} {{ record.last_name }}</a>
                                        </td>
                                        <td style="text-align: start;"><a title="Details" style="color: var(--text-color);" href="{% url 'course-details' record.course.id %}">{{ record.course }}</a></td>
                                        <td style="color: var(--text-color); text-align: start;">{{ record.attendance_rate|floatformat:2 }}%</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-12" style="position: relative; top: -20px;">
                <div class="card card-block card-stretch" style="background-color: var(--background-color);">
                    <div class="card-header d-flex align-items-center justify-content-between" style="">
                        <div class="header-title">
                            <h4 class="card-title"><a href="{% url 'attendance-history' %}" style="color: var(--text-color);">Recent Attendance Records</a></h4>
                        </div>
                    </div>
                    <div class="card-body">
                        <div style="overflow: auto; height: 300px; ">
                            <table class="table">
                                <thead class=" ">
                                    <tr class="ligth ligth-data">
                                        <th style="text-align: start; color: var(--text-color);">Student</th>
                                        <th style="text-align: left; color: var(--text-color);">Course</th>
                                        <th style="text-align: left; color: var(--text-color);">Course Time</th>
                                        <th style="text-align: left; color: var(--text-color);">Record Time</th>
                                        <th style="text-align: left; color: var(--text-color);">Teacher</th>
                                        <th style="text-align: left; color: var(--text-color);">Status</th>
                                    </tr>
                                </thead>
                                <tbody class="ligth-body">
                                    {% for record in attendance_records %}
                                    <tr>
                                        <td style="text-align: start;">
                                            <a title="Details" style="color: var(--text-color);" href="{% url 'student-details' record.student.id %}">{{ record.student.first_name }} {{ record.student.last_name }}</a>
                                        </td>
                                        <td style="text-align: start;"><a title="Details" style="color: var(--text-color);" href="{% url 'course-details' record.course.id %}">{{ record.course }}</a></td>
                                        <td style="color: var(--text-color);">{{ record.course.course_time }}</td>
                                        <td style="color: var(--text-color);">{{ record.time }}</td>
                                        <td style="color: var(--text-color);">
                                            <a title="Details" style="color: var(--text-color);" href="{% url 'teacher-details' record.student.course.course_teacher.id %}">
                                                {{ record.student.course.course_teacher.first_name }} {{ record.student.course.course_teacher.last_name }}
                                            </a>
                                        </td>
                                        {% if record.status %}
                                        <td style="color: var(--text-color); text-align: start;">✅ Present</td>
                                        {% else %}
                                        <td style="color: var(--text-color); text-align: start;">❌ Absent</td>
                                        {% endif %}
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Page end  -->
        </div>
    </div>
</div>
<script>
    let counters = document.querySelectorAll(".count");

    counters.forEach((item) => {
        let start = 0;
        let target = parseInt(item.dataset.target);
        let type = item.dataset.type; // "number" or "percent"

        let duration = 2000; // total animation time (ms)
        let step = Math.ceil(target / (duration / 50));

        function counterup() {
            start += step;
            if (start >= target) {
                start = target; // prevent overshoot
                clearInterval(stop);
            }

            // ✅ Choose display format
            if (type === "percent") {
                item.innerHTML = start + "%";
            } else {
                item.innerHTML = start;
            }
        }

        let stop = setInterval(counterup, 50);
    });
</script>
{% endblock %}
