{% extends 'base.html' %}

{% block content %}
            <div class="content-page">
                <div class="container-fluid">
                    <div class="card-header-toolbar d-flex align-items-center"></div>
                    <div class="row">
                        <div class="col-lg-12">
                            {% if messages %}
							<div id="errbox" class="errbox">
								{% for message in messages %}
                                <div class="errbox-icon">&#9888;</div>
								<div class="errbox-content">
									<p style="font-size: 15px;">{{ message }}</p>
								</div>
								<button class="errbox-close" onclick="document.getElementById('errbox').style.display='none'">&times;</button>
                                {% endfor %}
							</div>
                            {% endif %}
                            <h5 style="margin-bottom: 25px; margin-top: -18px; font-weight: 600; color: #333;">General Statistics</h5>
                            <div class="row" style="position: relative; top: -20px;">
                                <div style="height: 130px;" class="col-lg-4 col-md-3">
                                    <div class="card card-block card-stretch card-height" style="background-color: var(--main-color); ">
                                        <div class="card-body">
                                            <a href="{% url 'student-list' %}">
                                                <div class="d-flex align-items-center mb-4 card-total-sale">
                                                    <div class="icon iq-icon-box-2 bg-info-light" style="background-color: white !important;">
                                                        <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 1024 768">
                                                            <path
                                                                fill="var(--main-color)"
                                                                d="M1024 736q0 13-9.5 22.5T992 768t-22.5-9.5T960 736V315L607 492q-40 20-95 20t-95-20L39 303Q0 283 0 255.5T39 209L417 20q40-20 95-20t95 20l378 189q34 17 38 42q1 1 1 4v481zM639 556l193-97v141q0 43-93.5 73.5T512 704t-226.5-30.5T192 600V459l193 97q40 20 127 20t127-20z"
                                                            ></path>
                                                        </svg>
                                                    </div>
                                                    <div>
                                                        <p class="mb-2" style="color: white;">Students</p>
                                                        <h4 style="color: white;">{{ students.count }}</h4>
                                                    </div>
                                                </div>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                                <div style="height: 130px;" class="col-lg-4 col-md-3">
                                    <div class="card card-block card-stretch card-height" style="background-color: var(--main-color); ">
                                        <div class="card-body">
                                            <a href="{% url 'course-list' %}">
                                                <div class="d-flex align-items-center mb-4 card-total-sale">
                                                    <div class="icon iq-icon-box-2 bg-danger-light" style="background-color: white !important;">
                                                        <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 24 24">
                                                            <path fill="var(--main-color)" d="M19 3h-2v6.5l-3-2.25l-3 2.25V3H5v18h14V3Zm-6 0v2.5l1-.75l1 .75V3h-2Zm8 20H3V1h18v22Z"></path>
                                                        </svg>
                                                    </div>
                                                    <div>
                                                        <p class="mb-2" style="color: white;">Courses</p>
                                                        <h4 style="color: white;">{{ courses.count }}</h4>
                                                    </div>
                                                </div>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                                <div style="height: 130px;" class="col-lg-4 col-md-3">
                                    <div class="card card-block card-stretch card-height" style="background-color: var(--main-color); ">
                                        <div class="card-body">
                                            <a href="{% url 'select-course' %}">
                                                <div class="d-flex align-items-center mb-4 card-total-sale">
                                                    <div class="icon iq-icon-box-2 bg-success-light" style="background-color: white !important;">
                                                        <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 24 24">
                                                            <path
                                                                fill="var(--main-color)"
                                                                d="M17.5 12a5.5 5.5 0 1 1 0 11a5.5 5.5 0 0 1 0-11Zm-2.646 5.147a.5.5 0 1 0-.707.707l2 2a.5.5 0 0 0 .707 0l4-4a.5.5 0 1 0-.707-.707L16.5 18.793l-1.646-1.646ZM12.023 14a6.47 6.47 0 0 0-.709 1.5H4.253a.749.749 0 0 0-.75.75v.577c0 .535.192 1.053.54 1.46c1.253 1.469 3.22 2.214 5.957 2.214c.597 0 1.157-.035 1.68-.106c.246.495.553.954.912 1.367c-.795.16-1.66.24-2.592.24c-3.146 0-5.532-.906-7.098-2.74a3.75 3.75 0 0 1-.898-2.435v-.578A2.249 2.249 0 0 1 4.253 14h7.77ZM10 2.005a5 5 0 1 1 0 10a5 5 0 0 1 0-10Zm0 1.5a3.5 3.5 0 1 0 0 7a3.5 3.5 0 0 0 0-7Z"
                                                            ></path>
                                                        </svg>
                                                    </div>
                                                    <div>
                                                        <p class="mb-2" style="color: white;">Rate</p>
                                                        <h4 style="color: white;">{{ attendance_rate|floatformat:2 }}%</h4>
                                                    </div>
                                                </div>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <h5 style="margin-bottom: 25px; margin-top: -38px; font-weight: 600; color: #333;">Today’s Statistics</h5>
                            <div class="row" style="position: relative; top: -20px;">
                                <div style="height: 130px;" class="col-lg-3 col-md-3">
                                    <div class="card card-block card-stretch card-height" style=" background-color: white;">
                                        <div class="card-body">
                                            <div class="d-flex align-items-center mb-4 card-total-sale">
                                                <div class="icon iq-icon-box-2 bg-success-light" style="background-color: var(--main-color) !important;">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 10 10">
                                                        <path
                                                            fill="white"
                                                            d="M4.998 0a4.998 4.998 0 1 0 0 9.995a4.998 4.998 0 0 0 0-9.995ZM1 4.998a3.998 3.998 0 1 1 7.995 0a3.998 3.998 0 0 1-7.995 0Zm6.104-1.602a.5.5 0 0 1 0 .708l-2.25 2.25a.5.5 0 0 1-.708 0l-1-1a.5.5 0 1 1 .708-.708l.646.647l1.896-1.897a.5.5 0 0 1 .708 0Z"
                                                        ></path>
                                                    </svg>
                                                </div>
                                                <div>
                                                    <p class="mb-2" style="color: black;">Present</p>
                                                    <h4 style="color: black;">{{ present_student.count }}</h4>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div style="height: 130px;" class="col-lg-3 col-md-3">
                                    <div class="card card-block card-stretch card-height" style=" background-color: white;">
                                        <div class="card-body">
                                            <div class="d-flex align-items-center mb-4 card-total-sale">
                                                <div class="icon iq-icon-box-2 bg-success-light" style="background-color: var(--main-color) !important;">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 16 16">
                                                        <path
                                                            fill="white"
                                                            fill-rule="evenodd"
                                                            d="M14.1 13.2c1.2-1.4 1.92-3.21 1.92-5.2c0-4.42-3.58-8-8-8s-8 3.58-8 8s3.58 8 8 8a7.98 7.98 0 0 0 6.084-2.804zm-1.59.174a6.96 6.96 0 0 1-4.49 1.63c-3.87 0-7-3.13-7-7c0-1.71.612-3.27 1.63-4.49zm.884-.884l-9.86-9.86A6.96 6.96 0 0 1 8.024 1c3.87 0 7 3.13 7 7c0 1.71-.612 3.27-1.63 4.49"
                                                            clip-rule="evenodd"
                                                        ></path>
                                                    </svg>
                                                </div>
                                                <div>
                                                    <p class="mb-2" style="color: black;">Absent</p>
                                                    <h4 style="color: black;">{{ absent_students.count }}</h4>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div style="height: 130px;" class="col-lg-3 col-md-3">
                                    <div class="card card-block card-stretch card-height" style=" background-color: white;">
                                        <div class="card-body">
                                            <div class="d-flex align-items-center mb-4 card-total-sale">
                                                <div class="icon iq-icon-box-2 bg-success-light" style="background-color: var(--main-color) !important;">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 24 24">
                                                        <path fill="white" d="M12 21.934A9.934 9.934 0 1 1 21.933 12A9.945 9.945 0 0 1 12 21.934Zm0-18.868A8.934 8.934 0 1 0 20.933 12A8.944 8.944 0 0 0 12 3.066Z" />
                                                        <path
                                                            fill="white"
                                                            d="M9 10.258a1.5 1.5 0 1 1 1.061-.439A1.5 1.5 0 0 1 9 10.258Zm0-2a.5.5 0 1 0 .353.146A.5.5 0 0 0 9 8.259Zm-1.242 8.485a.5.5 0 0 1-.358-.853l8.489-8.49a.5.5 0 0 1 .707.707L8.111 16.6a.5.5 0 0 1-.353.143ZM15 16.742a1.5 1.5 0 1 1 1.061-.438a1.493 1.493 0 0 1-1.061.438Zm0-2a.5.5 0 0 0-.354.147a.5.5 0 0 0-.146.352a.5.5 0 1 0 1 0a.5.5 0 0 0-.5-.5Z"
                                                        ></path>
                                                    </svg>
                                                </div>
                                                <div>
                                                    <p class="mb-2" style="color: black;">Rate</p>
                                                    <h4 style="color: black;">{{ attendance_rate_today|floatformat:2 }}%</h4>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div style="height: 130px;" class="col-lg-3 col-md-3">
                                    <div class="card card-block card-stretch card-height" style=" background-color: white;">
                                        <div class="card-body">
                                            <div class="d-flex align-items-center mb-4 card-total-sale">
                                                <div class="icon iq-icon-box-2 bg-success-light" style="background-color: var(--main-color) !important;">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 24 24">
                                                        <path fill="white" d="M19 3h-2v6.5l-3-2.25l-3 2.25V3H5v18h14V3Zm-6 0v2.5l1-.75l1 .75V3h-2Zm8 20H3V1h18v22Z"></path>
                                                    </svg>
                                                </div>
                                                <div>
                                                    <p class="mb-2" style="color: black;">Courses</p>
                                                    <h4 style="color: black;">{{ todays_courses }}</h4>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-9 col-md-6" style="position: relative; top: -20px;">
                            <div class="card card-block card-stretch" style=" background-color: var(--background-color);">
                                <div class="card-header d-flex align-items-center justify-content-between" style="">
                                    <div class="header-title">
                                        <h4 class="card-title">Attendance Records</h4>
                                    </div>
                                    {% with request.path as current_url %}
                                    <div style="position: relative; top: -35px; left: 17px">
                                        <a href="{% url 'teacher-dashboard' 7 %}" style="border: 2px solid var(--main-color); border-radius: 5px; {% if current_url == '/teachers/7/' %} background-color: var(--main-color); color: white;{% else %}background-color: white; color: var(--main-color); {% endif %}; position: relative; top: 35px; left: -25px; padding: 8px;">7 days</a>
                                        <a href="{% url 'teacher-dashboard' 30 %}" style="border: 2px solid var(--main-color); border-radius: 5px; {% if current_url == '/teachers/30/' %} background-color: var(--main-color); color: white;{% else %}background-color: white; color: var(--main-color); {% endif %}; position: relative; top: 35px; left: -25px; padding: 8px;">30 days</a>
                                        <a href="{% url 'teacher-dashboard' 365 %}" style="border: 2px solid var(--main-color); border-radius: 5px; {% if current_url == '/teachers/365/' %} background-color: var(--main-color); color: white;{% else %}background-color: white; color: var(--main-color); {% endif %}; position: relative; top: 35px; left: -25px; padding: 8px;">1 year</a>
                                        <a href="{% url 'teacher-dashboard' %}" style="border: 2px solid var(--main-color); border-radius: 5px; {% if current_url == '/teachers/' %} background-color: var(--main-color); color: white;{% else %}background-color: white; color: var(--main-color); {% endif %};position: relative; top: 35px; left: -25px; padding: 8px;">Total</a>
                                    </div>
                                    {% endwith %}
                                </div>
                                <div class="card-body">
                                    <div>
                                        <canvas id="lineChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3" style="position: relative; top: -20px;">
                            <div class="card card-block card-stretch" style="">
                                <div class="card-header d-flex align-items-center justify-content-between" style="">
                                    <div class="header-title">
                                        <h4 class="card-title">Top Students</h4>
                                    </div>
                                </div>
                                <div style="overflow: auto; height: 465px;">
                                    <div class="card-body card-item-right">
                                        {% for student in top_students %}
                                        <div class="d-flex align-items-top">
                                            <div class="style-text text-left">
                                                <h5 class="mb-2">
                                                    <a style="color: var(--text-color)" title="Details" href="{% url 'student-details' student.id %}">
                                                        {{ student.first_name }} {{ student.last_name }}
                                                    </a>
                                                </h5>
                                                <p class="mb-2">
                                                    <a title="Details" style="color: var(--text-color)" href="{% url 'course-details' student.course.id %}">
                                                        Course : {{ student.course }}
                                                    </a>
                                                </p>
                                                <p class="mb-0">Attendance : {{ student.total_lessons }}</p>
                                                <p class="mb-0">Absence: {{ student.absent }}</p>
                                            </div>
                                        </div>
                                        <hr style="background-color: var(--text-color);" />
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-12" style="position: relative; top: -20px;">
                            <div class="card card-block card-stretch" style="">
                                <div class="card-header d-flex align-items-center justify-content-between" style="">
                                    <div class="header-title">
                                        <h4 class="card-title">Recent Attendance Records</h4>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div style="overflow: auto; height: 370px;">
                                        <table class="table">
                                            <thead class=" ">
                                                <tr class="ligth ligth-data">
                                                    <th style="text-align: start;">Student</th>
                                                    <th style="text-align: left">Course</th>
                                                    <th style="text-align: left">Course Time</th>
                                                    <th style="text-align: left">Record Time</th>
                                                    <th style="text-align: left">Teacher</th>
                                                    <th style="text-align: left">Status</th>
                                                </tr>
                                            </thead>
                                            <tbody class="ligth-body">
                                                {% for record in attendance_records %}
                                                <tr>
                                                    <td style="text-align: start;"><a title="Details" style="color: var(--text-color);" href="{% url 'student-details' record.student.id %}">{{ record.student.first_name }} {{ record.student.last_name }}</a></td>
                                                    <td style="text-align: start;"><a title="Details" style="color: var(--text-color);" href="{% url 'course-details' record.course.id %}">{{ record.course }}</a></td>
                                                    <td style="color: var(--text-color);">{{ record.course.course_time }}</td>
                                                    <td style="color: var(--text-color);">{{ record.time }}</td>
                                                    <td style="color: var(--text-color);"><a title="Details" style="color: var(--text-color);" href="{% url 'teacher-details' record.student.course.course_teacher.id %}">{{ record.student.course.course_teacher.first_name }} {{ record.student.course.course_teacher.last_name }}</a></td>
                                                    {% if record.status %}
                                                    <td style="color: var(--text-color);">✅ Present</td>
                                                    {% else %}
                                                    <td style="color: var(--text-color);">❌ Absent</td>
                                                    {% endif %}
                                                </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Page end  -->
                    </div>
                </div>
            </div>

            <script>
                // Retrieve data passed from the view
                var data = {{ gender_data|safe }};

                // Get the canvas element
                var canvas = document.getElementById('pieChart');

                // Create the chart
                new Chart(canvas, {
                    type: 'doughnut',
                    data: {
                        labels: data.labels,
                        datasets: [{
                            data: data.values,
                            borderColor: ['rgb(60 25 220)', 'blue', 'green', "grey", "rgb(92 11 214)"],
                            backgroundColor: 'white'
                        }]
                    }
                });
            </script>
            <script>
                // Retrieve the data points from the Django template context
                var dataPoints = {{ line_chart_data|safe }};

                // Get the canvas element
                var ctx = document.getElementById('lineChart').getContext('2d');

                // Create the line chart
                var chart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: dataPoints.labels,  // Example labels
                        datasets: [{
                            label: 'Attendance Records',
                            data: dataPoints.values,
                            backgroundColor: 'rgb(92 11 214)',
                            borderColor: 'rgb(92 11 214)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            </script>

{% endblock %}